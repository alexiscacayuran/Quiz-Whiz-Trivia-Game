<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
      crossorigin="anonymous"
    />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Fredoka:wght@300..700&display=swap"
      rel="stylesheet"
    />
    <link href="https://fonts.cdnfonts.com/css/peace-sans" rel="stylesheet" />
    <link rel="stylesheet" href="styles/main.css" />
    <title>Quiz Whiz: Trivia Game</title>
  </head>
  <body>
    <% const letterArray = ["A", "B", "C", "D"] %>
    <div class="bg-container vh-100">
      <div class="position-relative">
        <div class="container">
          <% for (const trivia of content) { %>
          <div class="trivia">
            <div class="d-flex flex-column mt-2">
              <p id="question-number" class="text-center p-0">
                <%= content.indexOf(trivia) + 1 %> out of 10
              </p>
              <p id="category-picked" class="text-center p-0">
                <%= trivia.category %>
              </p>
            </div>

            <div id="question" class="col-12 mt-2 w-100">
              <h2
                class="d-flex align-items-center justify-content-center text-center p-4"
              >
                <%= trivia.question %>
              </h2>
            </div>

            <div class="choices-container">
              <div class="row">
                <% trivia.choices.forEach((element, index) => { %> <% if(index
                === 0 || index === 2 ){ %>
                <div class="col-6">
                  <button class="choices w-100 p-0 mt-4" id="<%= element %>">
                    <div
                      class="choices-button-top d-flex align-items-center w-100"
                    >
                      <div
                        class="circle d-flex align-items-center justify-content-center"
                      >
                        <span class="letters"><%= letterArray[index] %></span>
                      </div>
                      <p class="answer flex-fill m-0" style="display: inline">
                        <%= element %>
                      </p>
                    </div>
                  </button>
                </div>

                <% } %> <% }); %>
              </div>

              <div class="row">
                <% trivia.choices.forEach((element, index) => { %> <% if(index
                === 1 || index === 3 ){ %>
                <div class="col-6">
                  <button class="choices w-100 p-0 mt-4" id="<%= element %>">
                    <div
                      class="choices-button-top d-flex align-items-center w-100"
                    >
                      <div
                        class="circle col-2 d-flex align-items-center justify-content-center"
                      >
                        <span class="letters"><%= letterArray[index] %></span>
                      </div>
                      <p
                        class="answer col flex-fill m-0"
                        style="display: inline"
                      >
                        <%= element %>
                      </p>
                    </div>
                  </button>
                </div>

                <% } %> <% }); %>
              </div>
            </div>

            <p style="display: none" id="<%= trivia.correct_answer %>"></p>
          </div>
          <% } %>

          <div class="result" style="display: none">
            <h2 class="result-message">Great!</h2>
            <p>Your score:</p>
            <p class="result-score"></p>
            <div class="result-button">
              <form method="post">
                <input type="hidden" name="amount" value="10" />
                <input type="hidden" name="difficulty" value="easy" />
                <input type="hidden" name="type" value="multiple" />
                <button type="submit" id="quickPlay" formaction="\play">
                  TRY AGAIN
                </button>
              </form>

              <button id="play" onclick="window.location.href='/'">
                BACK TO MENU
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </body>
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script
    src="https://code.jquery.com/jquery-3.7.1.js"
    integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4="
    crossorigin="anonymous"
  ></script>
  <script src="https://cdn.jsdelivr.net/npm/ejs@3.1.10/ejs.min.js"></script>

  <script>
    const amount = $(".trivia").length;
    const delay = 1000;
    var points = 0;

    $(".trivia").hide();
    $(".trivia").first().show();

    const openQuestion = `.trivia[style]:not([style="display: none;"])`;
    const answerKey = `p[style="display: none"]`;

    $(".choices-container > :first-child > div:first-child .circle").addClass(
      "yellow"
    );

    $(".choices-container > :first-child > div:last-child .circle").addClass(
      "green"
    );

    $(".choices-container > :last-child > div:first-child .circle").addClass(
      "purple"
    );

    $(".choices-container > :last-child > div:last-child .circle").addClass(
      "orange"
    );

    $(".choices").one("click", (event) => {
      const answer = $(event.target).closest(".choices").attr("id");
      var correct_answer = $(openQuestion + " > " + answerKey).attr("id");

      console.log("Event:", event.target);
      console.log("Answer:", answer);
      console.log("Correct:", correct_answer);

      if (answer === correct_answer) {
        points++;
        $(event.target)
          .closest(".choices-button-top")
          .addClass("correct-button-top")
          .closest(".choices")
          .addClass("correct-button");
        setTimeout(() => {
          $(event.target)
            .closest(".choices-button-top")
            .removeClass("correct-button-top");
        }, delay);
      } else {
        $(event.target)
          .closest(".choices-button-top")
          .addClass("wrong-button-top")
          .closest(".choices")
          .addClass("wrong-button");

        $(
          openQuestion + ` .choices-button-top:contains(` + correct_answer + `)`
        ).addClass("correct-button-top");
        $(openQuestion + ` .choices:contains(` + correct_answer + `)`).addClass(
          "correct-button"
        );

        setTimeout(() => {
          $(event.target)
            .closest(".choices-button-top")
            .removeClass("wrong-button-top")
            .closest(".choices")
            .addClass("wrong-button");
          $(
            openQuestion +
              ` .choices-button-top:contains(` +
              correct_answer +
              `)`
          ).removeClass("correct-button-top");

          $(
            openQuestion + ` .choices:contains(` + correct_answer + `)`
          ).removeClass("correct-button");
        }, delay);
      }

      if ($(openQuestion).next(".trivia").length) {
        $(openQuestion).delay(delay).hide(0).next().delay(delay).fadeIn(200);
      } else {
        const score = (points / amount) * 100;

        $(openQuestion).delay(delay).hide(0);

        setTimeout(() => {
          $(".result-score").text(`${score}`);
          $(".result").fadeIn(200);
        }, delay);
      }
    });
  </script>
</html>
